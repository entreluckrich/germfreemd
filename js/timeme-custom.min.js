// it was removed from the original file the idleTimeoutInSeconds property
(function(){var e,t;e=this,t=function(){var a={startStopTimes:{},checkStateRateMs:250,active:!1,idle:!1,currentPageName:"default-page-name",timeElapsedCallbacks:[],userLeftCallbacks:[],userReturnCallbacks:[],trackTimeOnElement:function(e){var t=document.getElementById(e);t&&(t.addEventListener("mouseover",function(){a.startTimer(e)}),t.addEventListener("mousemove",function(){a.startTimer(e)}),t.addEventListener("mouseleave",function(){a.stopTimer(e)}),t.addEventListener("keypress",function(){a.startTimer(e)}),t.addEventListener("focus",function(){a.startTimer(e)}))},getTimeOnElementInSeconds:function(e){var t=a.getTimeOnPageInSeconds(e);return t||0},startTimer:function(e){if(e||(e=a.currentPageName),void 0===a.startStopTimes[e])a.startStopTimes[e]=[];else{var t=a.startStopTimes[e],n=t[t.length-1];if(void 0!==n&&void 0===n.stopTime)return}a.startStopTimes[e].push({startTime:new Date,stopTime:void 0}),a.active=!0},stopAllTimers:function(){for(var e=Object.keys(a.startStopTimes),t=0;t<e.length;t++)a.stopTimer(e[t])},stopTimer:function(e){e||(e=a.currentPageName);var t=a.startStopTimes[e];void 0!==t&&0!==t.length&&(void 0===t[t.length-1].stopTime&&(t[t.length-1].stopTime=new Date),a.active=!1)},getTimeOnCurrentPageInSeconds:function(){return a.getTimeOnPageInSeconds(a.currentPageName)},getTimeOnPageInSeconds:function(e){return void 0===a.getTimeOnPageInMilliseconds(e)?void 0:a.getTimeOnPageInMilliseconds(e)/1e3},getTimeOnCurrentPageInMilliseconds:function(){return a.getTimeOnPageInMilliseconds(a.currentPageName)},getTimeOnPageInMilliseconds:function(e){var t=a.startStopTimes[e];if(void 0!==t){for(var n=0,i=0;i<t.length;i++){var s=t[i].startTime,o=t[i].stopTime;void 0===o&&(o=new Date),n+=o-s}return Number(n)}},getTimeOnAllPagesInSeconds:function(){for(var e=[],t=Object.keys(a.startStopTimes),n=0;n<t.length;n++){var i=t[n],s=a.getTimeOnPageInSeconds(i);e.push({pageName:i,timeOnPage:s})}return e},setCurrentPageName:function(e){return a.currentPageName=e,this},resetRecordedPageTime:function(e){delete a.startStopTimes[e]},resetAllRecordedPageTimes:function(){for(var e=Object.keys(a.startStopTimes),t=0;t<e.length;t++)a.resetRecordedPageTime(e[t])},resetIdleCountdown:function(){a.idle&&a.triggerUserHasReturned(),a.idle=!1},callWhenUserLeaves:function(e,t){this.userLeftCallbacks.push({callback:e,numberOfTimesToInvoke:t})},callWhenUserReturns:function(e,t){this.userReturnCallbacks.push({callback:e,numberOfTimesToInvoke:t})},triggerUserHasReturned:function(){if(!a.active)for(var e=0;e<this.userReturnCallbacks.length;e++){var t=this.userReturnCallbacks[e],n=t.numberOfTimesToInvoke;(isNaN(n)||void 0===n||0<n)&&(t.numberOfTimesToInvoke-=1,t.callback())}a.startTimer()},triggerUserHasLeftPage:function(){if(a.active)for(var e=0;e<this.userLeftCallbacks.length;e++){var t=this.userLeftCallbacks[e],n=t.numberOfTimesToInvoke;(isNaN(n)||void 0===n||0<n)&&(t.numberOfTimesToInvoke-=1,t.callback())}a.stopAllTimers()},callAfterTimeElapsedInSeconds:function(e,t){a.timeElapsedCallbacks.push({timeInSeconds:e,callback:t,pending:!0})},checkState:function(){for(var e=0;e<a.timeElapsedCallbacks.length;e++)a.timeElapsedCallbacks[e].pending&&a.getTimeOnCurrentPageInSeconds()>a.timeElapsedCallbacks[e].timeInSeconds&&(a.timeElapsedCallbacks[e].callback(),a.timeElapsedCallbacks[e].pending=!1)},visibilityChangeEventName:void 0,hiddenPropName:void 0,listenForVisibilityEvents:function(){void 0!==document.hidden?(a.hiddenPropName="hidden",a.visibilityChangeEventName="visibilitychange"):void 0!==document.mozHidden?(a.hiddenPropName="mozHidden",a.visibilityChangeEventName="mozvisibilitychange"):void 0!==document.msHidden?(a.hiddenPropName="msHidden",a.visibilityChangeEventName="msvisibilitychange"):void 0!==document.webkitHidden&&(a.hiddenPropName="webkitHidden",a.visibilityChangeEventName="webkitvisibilitychange"),document.addEventListener(a.visibilityChangeEventName,function(){document[a.hiddenPropName]?a.triggerUserHasLeftPage():a.triggerUserHasReturned()},!1),window.addEventListener("blur",function(){a.triggerUserHasLeftPage()}),window.addEventListener("focus",function(){a.triggerUserHasReturned()}),document.addEventListener("mousemove",function(){a.resetIdleCountdown()}),document.addEventListener("keyup",function(){a.resetIdleCountdown()}),document.addEventListener("touchstart",function(){a.resetIdleCountdown()}),window.addEventListener("scroll",function(){a.resetIdleCountdown()}),setInterval(function(){a.checkState()},a.checkStateRateMs)},websocket:void 0,websocketHost:void 0,setUpWebsocket:function(t){if(window.WebSocket&&t){var e=t.websocketHost;try{a.websocket=new WebSocket(e),window.onbeforeunload=function(e){a.sendCurrentTime(t.appId)},a.websocket.onopen=function(){a.sendInitWsRequest(t.appId)},a.websocket.onerror=function(e){console&&console.log("Error occurred in websocket connection: "+e)},a.websocket.onmessage=function(e){console&&console.log(e.data)}}catch(e){console&&console.error("Failed to connect to websocket host.  Error:"+e)}}return this},websocketSend:function(e){a.websocket.send(JSON.stringify(e))},sendCurrentTime:function(e){var t={type:"INSERT_TIME",appId:e,timeOnPageMs:a.getTimeOnCurrentPageInMilliseconds(),pageName:a.currentPageName};a.websocketSend(t)},sendInitWsRequest:function(e){var t={type:"INIT",appId:e};a.websocketSend(t)},initialize:function(e){var t,n=a.currentPageName||"default-page-name";e&&(n=e.currentPageName||n,t=e.websocketOptions),a.setCurrentPageName(n).setUpWebsocket(t).listenForVisibilityEvents(),a.startTimer()}};return a},"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define([],function(){return e.TimeMe=t()}):e.TimeMe=t()}).call(this);